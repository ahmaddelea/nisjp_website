import PaletteSelector from"./palette-selector";import{Preview as PreviewUtility}from"../preview";export class Preview{constructor(){this.previewUtility=new PreviewUtility,this.classControls=[{name:"bgtfw_footer_color",selector:"#colophon:not(.template-footer), .footer-content:not(.template-footer)",properties:["background-color","text-default"]},{name:"bgtfw_tagline_color",selector:".site-description",properties:["color"]},{name:"bgtfw_site_title_color",selector:".site-title",properties:["color"]},{name:"bgtfw_blog_post_background_color",selector:".palette-primary.archive .post, .palette-primary.blog .post",properties:["background-color","text-default"]},{name:"bgtfw_blog_post_header_title_color",selector:".archive .post .entry-title .link, .blog .post .entry-title .link",properties:["color","color-hover"]},{name:"bgtfw_blog_header_background_color",selector:".palette-primary.archive .post .entry-header, .palette-primary.blog .post .entry-header",properties:["background-color","text-default"]},{name:"bgtfw_global_title_background_color",selector:".page-header",properties:["background-color","text-default"]},{name:"bgtfw_global_title_color",selector:".page-header .entry-title .link, .page-header .page-title .link",properties:["color","color-hover"]},{name:"bgtfw_footer_links",selector:".footer-content:not(.template-footer)",properties:["link-color"]}]}init(){return $(()=>this._onLoad()),this}outputColor(e,t,o,r){let n,l=$(t),i=new RegExp("(color-?([\\d]|neutral)|transparent)-("+o.join("|")+")(\\s+|$)","g");(e=parent.wp.customize(e)())&&"none"!==e||(e=""),l.removeClass((e,t)=>(t.match(i)||[]).join(" ")),n=(new PaletteSelector).getColorNumber(e),l.addClass(_.map(o,e=>{let t=n;return-1===n.indexOf("neutral")&&-1===e.indexOf("link-color")&&(t=n.replace("-","")),t+"-"+e}).join(" ")),r&&l.addClass(_.map(o,e=>{let t=n;return-1===n.indexOf("neutral")&&-1===e.indexOf("link-color")&&(t=n.replace("-","")),t+"-"+e+" transparent-"+e}).join(" "))}getHeadingCSS(e){const t=(new PaletteSelector).getColor(e);let o="",r=[];return t&&(o=`\n\t\t\t\t${r=this.getHeadingColorSelectors().join(", ")} {\n\t\t\t\t\tcolor: ${t};\n\t\t\t\t}\n\t\t\t`),o}getWeformsLabelCss(e){const t=(new PaletteSelector).getColor(e);var o=t;let r="",n=t?t.indexOf(";"):-1,l=[];return t&&(o=-1!==n?t.split(";")[0]:t,r=`\n\t\t\t\t${l=this.getWeformsLabelColorSelectors().join(", ")} {\n\t\t\t\t\tcolor: ${o} !important;\n\t\t\t\t}\n\t\t\t`),r}getWeformsSubLabelCss(e){const t=(new PaletteSelector).getColor(e);var o=t;let r="",n=t?t.indexOf(";"):-1,l=[];return t&&(o=-1!==n?t.split(";")[0]:t,r=`\n\t\t\t\t${l=this.getWeformsSubLabelColorSelectors().join(", ")} {\n\t\t\t\t\tcolor: ${o} !important;\n\t\t\t\t}\n\t\t\t`),r}getHeadingColorSelectors(){const e=[];return _.each(BOLDGRID.CUSTOMIZER.data.customizerOptions.typography.selectors,function(t,o){"headings"===t.type&&e.push(o)}),e}getWeformsLabelColorSelectors(){const e=[];return _.each(BOLDGRID.CUSTOMIZER.data.customizerOptions.typography.selectors,function(t,o){"weformsLabel"===t.type&&e.push(o)}),e}getWeformsSubLabelColorSelectors(){const e=[];return _.each(BOLDGRID.CUSTOMIZER.data.customizerOptions.typography.selectors,function(t,o){"weformsSubLabel"===t.type&&e.push(o)}),e}setHeadingColors(){const e=this.getHeadingCSS(wp.customize("bgtfw_headings_color")());this.previewUtility.updateDynamicStyles("bgtfw_headings_color",e)}setWeformsColors(){const e=this.getWeformsLabelCss(wp.customize("bgtfw_weforms_label_color")());this.previewUtility.updateDynamicStyles("bgtfw_weforms_label_color",e)}setWeformsSubColors(){const e=this.getWeformsSubLabelCss(wp.customize("bgtfw_weforms_sublabel_color")());this.previewUtility.updateDynamicStyles("bgtfw_weforms_sublabel_color",e)}getHamburgerCSS(e,t){return`\n\t\t.${t}-btn .hamburger-inner,\n\t\t.${t}-btn .hamburger-inner::before,\n\t\t.${t}-btn .hamburger-inner::after {\n\t\t\tbackground-color: ${(new PaletteSelector).getColor(e)};\n\t\t}`}getActiveLinkColor(e,t){return`\n\t\t#${t} .current-menu-item:not( .btn ) > a,\n\t\t#${t} .current-menu-ancestor:not( .btn ) > a,\n\t\t#${t} .current-menu-parent:not( .btn ) > a {\n\t\t\tcolor: ${(new PaletteSelector).getColor(e)};\n\t\t}`}getSubActiveLinkColor(e,t){return`\n\t\t#${t} ul > .current-menu-item:not( .btn ) > a,\n\t\t#${t} ul > .current-menu-ancestor:not( .btn ) > a,\n\t\t#${t} ul > .current-menu-parent:not( .btn ) > a {\n\t\t\tcolor: ${(new PaletteSelector).getColor(e)};\n\t\t}`}getHoverLinkColor(e,t){return`\n\t\t#${t} .hvr-none:not( .current-menu-item ):not( .button ) > a:hover,\n\t\t#${t} .hvr-none:not( .current-menu-ancestor ):not( .button ) > a:hover,\n\t\t#${t} .hvr-none:not( .current-menu-parent ):not( .button ) > a:hover {\n\t\t\tcolor: ${(new PaletteSelector).getColor(e)};\n\t\t}`}getMenuColorsCSS(e){let t=`bgtfw_menu_background_${e}`,o=`bgtfw_menu_submenu_background_${e}`,r=!1;(wp.customize(t)().includes("transparent")||_.isUndefined(wp.customize(t)()))&&(t="header",BOLDGRID.CUSTOMIZER.data.menu.footerMenus.includes(e)&&(t="footer",r=!0),t=`bgtfw_${t}_color`),(wp.customize(o)().includes("transparent")||_.isUndefined(wp.customize(o)()))&&(o="header",BOLDGRID.CUSTOMIZER.data.menu.footerMenus.includes(e)&&(o="footer",r=!0),o=`bgtfw_${o}_color`);let n=new PaletteSelector,l=wp.customize(t)(),i=wp.customize(o)(),s=n.getColor(i);l=n.getColor(l,!0),i=n.getColor(i,!0);let a=parent.net.brehaut.Color(l),c=parent.net.brehaut.Color(i),u="";return r||(u+=`.header-left #main-menu, .header-right #main-menu { background-color: ${a}; }`),u+="@media (min-width: 768px) {",u+=`#${e=e.replace(/_/g,"-")}-menu.sm-clean ul {background-color: ${s};}`,u+=`#${e}-menu.sm-clean ul a, #${e}-menu.sm-clean ul a:hover, #${e}-menu.sm-clean ul a:focus, #${e}-menu.sm-clean ul a:active, #${e}-menu.sm-clean ul a.highlighted, #${e}-menu.sm-clean span.scroll-up, #${e}-menu.sm-clean span.scroll-down, #${e}-menu.sm-clean span.scroll-up:hover, #${e}-menu.sm-clean span.scroll-down:hover {background-color: ${c};}`,u+=`#${e}-menu.sm-clean ul { border: 1px solid ${c};}`,u+=`#${e}-menu.sm-clean > li > ul:before, #${e}-menu.sm-clean > li > ul:after { border-color: transparent transparent ${s} transparent;}`,u+="}"}setMenuColors(e){let t=this.getMenuColorsCSS(e);this.previewUtility.updateDynamicStyles(`menu-colors-${e}-inline-css`,t)}getHoverCSS(e){const t=(new PaletteSelector).getColor(wp.customize(`bgtfw_menu_items_hover_color_${e}`)()),o=(new PaletteSelector).getColor(wp.customize(`bgtfw_menu_items_hover_background_${e}`)());let r=BOLDGRID.CUSTOMIZER.data.hoverColors;return e=e.replace(/_/g,"-"),r=(r=(r=(r=r.replace(/%1\$s/g,`#${e}-menu`)).replace(/%2\$s/g,o)).replace(/%3\$s/g,t)).replace(/%4\$s/g,o)}setHamburgerColors(e,t){let o=wp.customize(`bgtfw_menu_hamburger_${e}_color`)(),r=this.getHamburgerCSS(o,t);this.previewUtility.updateDynamicStyles(`bgtfw_menu_hamburger_${e}_color`,r)}setHoverColors(e){let t=this.getHoverCSS(e);this.previewUtility.updateDynamicStyles(`hover-${e}-inline-css`,t)}setActiveSubLinkColor(e,t){let o=`bgtfw_menu_items_sub_active_link_color_${e}`,r=wp.customize(o)(),n=this.getSubActiveLinkColor(r,t);this.previewUtility.updateDynamicStyles(`active-link-sub-color-${e}-inline-css`,n)}setActiveLinkColor(e,t){let o=`bgtfw_menu_items_active_link_color_${e}`,r=wp.customize(o)(),n=this.getActiveLinkColor(r,t);this.previewUtility.updateDynamicStyles(`active-link-color-${e}-inline-css`,n)}setHoverLinkColor(e,t){let o=`bgtfw_menu_items_hover_link_color_${e}`,r=wp.customize(o)(),n=this.getHoverLinkColor(r,t);this.previewUtility.updateDynamicStyles(`hover-link-color-${e}-inline-css`,n)}setMenuConfigs(e,t){this.classControls.push({name:`bgtfw_menu_border_color_${e}`,selector:`#${t}`,properties:["border-color"]},{name:`bgtfw_menu_items_border_color_${e}`,selector:`#${t} > li`,properties:["border-color"]},{name:`bgtfw_menu_background_${e}`,selector:`#${t}`,properties:["background-color"]},{name:`bgtfw_menu_submenu_background_${e}`,selector:`#${t} ul`,properties:["background-color"]},{name:`bgtfw_menu_items_link_color_${e}`,selector:`#${t}`,properties:["link-color"]},{name:`bgtfw_menu_items_sub_link_color_${e}`,selector:`#${t}`,properties:["sub-link-color"]},{name:`bgtfw_menu_items_active_link_background_${e}`,selector:`#${t} > li.current-menu-item`,properties:["background-color"]},{name:`bgtfw_menu_items_active_link_border_color_${e}`,selector:`#${t} > li.current-menu-item`,properties:["border-color"]})}setHeaderOverlay(){const e=(new PaletteSelector).getColor(wp.customize("bgtfw_header_overlay_color")(),!0),t=wp.customize("bgtfw_header_overlay_alpha")(),o=parent.net.brehaut.Color(e).setAlpha(t).toString();let r="#wp-custom-header::after{ display: none; }";wp.customize("bgtfw_header_overlay")()&&(r=`\n\t\t\t\t#wp-custom-header::after {\n\t\t\t\t\tbackground-color: ${o} !important;\n\t\t\t\t}\n\t\t\t`),this.previewUtility.updateDynamicStyles("bgtfw-header-overlay-inline-css",r)}setPageTitles(e,t){const o=(new PaletteSelector).getColor(wp.customize(e)(),!0),r=parent.net.brehaut.Color(o).setAlpha(.7).toString();let n=/rgba\(\s?([0-9]+),\s?([0-9]+),\s?([0-9]+),\s?([0-9|.]+)\s?\)/g,l=$(t);_.each(l,function(e){let t=(e=$(e)).css("background-image"),o=!1,l=(i=t,s=/((?:[^"']|".*?"|'.*?')*?)([(,)]|$)/g,function e(){var t;for(let o=[];;){if("("===(t=s.exec(i))[2]?(o.push(t[1].trim()+"("+e().join(", ")+")"),t=s.exec(i)):o.push(t[1].trim()),","!==t[2])return o;","===t[2]&&"%"===t[1][t[1].length-1]&&(o[o.length-1]+=t[1])}}());var i,s;let a=l.filter(e=>e.includes("linear-gradient"));if(0<a.length&&n.test(a[0])){let e=a[0].replace(/\s+/g,"");e=e.replace(n,r),o=t.replace(a[0],e)}else{l.filter(e=>e.includes("url("))&&(o="linear-gradient("+r+", "+r+"), "+t)}o&&e.css("background-image",o)})}menus(){var e=Object.values(_wpCustomizePreviewNavMenusExports.navMenuInstanceArgs);e.push({theme_location:"social",menu_id:"social-menu"}),e.push({theme_location:"sticky-social",menu_id:"sticky-social-menu"});for(const t of e)t.theme_location&&(this.setMenuConfigs(t.theme_location,t.menu_id),this.setHamburgerColors(t.theme_location,t.menu_id),this.setHoverColors(t.theme_location),this.setActiveLinkColor(t.theme_location,t.menu_id),this.setActiveSubLinkColor(t.theme_location,t.menu_id),this.setMenuColors(t.theme_location),this._bindHoverColors(t.theme_location),this._bindMenuColors(t.theme_location),this._bindActiveLinkColors(t.theme_location,t.menu_id),this._bindHoverLinkColors(t.theme_location,t.menu_id),this._bindHamburgerColors(t.theme_location,t.menu_id))}_onLoad(){this.setHeadingColors(),this.menus(),this._bindConfiguredControls(),this._bindHeadingColor(),this._bindWeformsColor(),this._bindWeformsSubColor(),this._bindHeaderOverlay(),this._bindEntryHeader(),this._bindGlobalPageTitles()}_bindEntryHeader(){wp.customize("bgtfw_blog_header_background_color",(...e)=>{e.map(e=>e.bind(()=>this.setPageTitles("bgtfw_blog_header_background_color",".has-post-thumbnail .entry-header:not(.page-header)")))})}_bindGlobalPageTitles(){wp.customize("bgtfw_global_title_background_color",(...e)=>{e.map(e=>e.bind(()=>this.setPageTitles("bgtfw_global_title_background_color",".page-header.has-featured-image-header")))})}_bindHeaderOverlay(){wp.customize("bgtfw_header_overlay_alpha","bgtfw_header_overlay","bgtfw_header_overlay_color",(...e)=>{e.map(e=>e.bind(()=>this.setHeaderOverlay()))})}_bindMenuColors(e){wp.customize(`bgtfw_menu_background_${e}`,`bgtfw_menu_submenu_background_${e}`,"bgtfw_header_color","bgtfw_footer_color",(...t)=>{t.map(t=>t.bind(()=>this.setMenuColors(e)))})}_bindConfiguredControls(){for(const e of this.classControls)wp.customize(e.name,t=>{t.bind(()=>this.outputColor(e.name,e.selector,e.properties))})}_bindHeadingColor(){wp.customize("bgtfw_headings_color",e=>{e.bind(()=>this.setHeadingColors())})}_bindWeformsColor(){wp.customize("bgtfw_weforms_label_color",e=>{e.bind(()=>this.setWeformsColors())})}_bindWeformsSubColor(){wp.customize("bgtfw_weforms_sublabel_color",e=>{e.bind(()=>this.setWeformsSubColors())})}_bindHamburgerColors(e,t){wp.customize(`bgtfw_menu_hamburger_${e}_color`,o=>{o.bind(()=>this.setHamburgerColors(e,t))})}_bindHoverColors(e){wp.customize(`bgtfw_menu_items_hover_color_${e}`,t=>{t.bind(()=>this.setHoverColors(e))}),wp.customize(`bgtfw_menu_items_hover_background_${e}`,t=>{t.bind(()=>this.setHoverColors(e))})}_bindActiveLinkColors(e,t){wp.customize(`bgtfw_menu_items_active_link_color_${e}`,o=>{o.bind(()=>this.setActiveLinkColor(e,t))}),wp.customize(`bgtfw_menu_items_sub_active_link_color_${e}`,o=>{o.bind(()=>this.setActiveSubLinkColor(e,t))})}_bindHoverLinkColors(e,t){wp.customize(`bgtfw_menu_items_hover_link_color_${e}`,o=>{o.bind(()=>this.setHoverLinkColor(e,t))})}}export default Preview;