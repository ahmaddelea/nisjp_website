import{Preview as PreviewUtility}from"../preview";import PaletteSelector from"../color/palette-selector";const api=wp.customize,colorLib=window.net.brehaut;export class LinkPreview{constructor(){this.previewUtility=new PreviewUtility,this.paletteSelector=new PaletteSelector,this.prefixes=["bgtfw_body","bgtfw_posts_date","bgtfw_posts_byline","bgtfw_posts_tags","bgtfw_posts_cats","bgtfw_posts_navigation","bgtfw_blog_post_header_byline","bgtfw_blog_post_header_date","bgtfw_blog_post_cats","bgtfw_blog_post_tags","bgtfw_blog_post_comments","bgtfw_blog_post_readmore"],this.selectors={}}bindEvents(){$(()=>{let t=this.prefixes;for(let o of t){this.selectors[o]=this.getSelectors(o);let t=[`${o}_link_color`,`${o}_link_color_hover`,`${o}_link_decoration`,`${o}_link_decoration_hover`];"bgtfw_body"!==o&&t.push(`${o}_link_color_display`),api(...t,(...t)=>{t.map(t=>t.bind(()=>this.updateStyles(o)))})}})}getSelectors(t){let o=[];return parent.wp.customize.control&&parent.wp.customize.control(`${t}_link_color`)&&(o=parent.wp.customize.control(`${t}_link_color`).params.choices.selectors),o}updateStyles(t){let o="";if(!1===_.isFunction(api(`${t}_link_color_display`))||"inherit"!==api(`${t}_link_color_display`)()){let e,n=this._getColor(`${t}_link_color`,!0),r=api(`${t}_link_color_hover`)()||0,i=this._getDecoration(`${t}_link_decoration`),l=this._getDecoration(`${t}_link_decoration_hover`),_="",s=this.selectors[t];r=parseInt(r,10)/100,e=colorLib.Color(n).lightenByAmount(r).toCSS();for(let t of s)o+=`\n\t\t\t\t\t${t+=_} {\n\t\t\t\t\t\tcolor: ${n};\n\t\t\t\t\t\ttext-decoration: ${i};\n\t\t\t\t\t}\n\t\t\t\t\t${t}:hover,\n\t\t\t\t\t${t}:focus {\n\t\t\t\t\t\tcolor: ${e};\n\t\t\t\t\t\ttext-decoration: ${l};\n\t\t\t\t\t}\n\t\t\t\t`;if("bgtfw_body"===t){let e,n=this._getColor("bgtfw_footer_links",!0),r=api(`${t}_link_color_hover`)()||0;r=parseInt(r,10)/100,o+=`\n\t\t\t\t#colophon .bgtfw-footer.footer-content > a:not( .btn ),\n\t\t\t\t#colophon .bgtfw-footer.footer-content *:not( .menu-item ) > a:not( .btn ) {\n\t\t\t\t\ttext-decoration: ${i};\n\t\t\t\t}\n\t\t\t\t#colophon .bgtfw-footer.footer-content > a:not( .btn ):hover,\n\t\t\t\t#colophon .bgtfw-footer.footer-content > a:not( .btn ):focus,\n\t\t\t\t#colophon .bgtfw-footer.footer-content *:not( .menu-item ) > a:not( .btn ):hover,\n\t\t\t\t#colophon .bgtfw-footer.footer-content *:not( .menu-item ) > a:not( .btn ):focus {\n\t\t\t\t\t\tcolor: ${e=colorLib.Color(n).lightenByAmount(r).toCSS()};\n\t\t\t\t\t\ttext-decoration: ${l};\n\t\t\t\t\t}\n\t\t\t\t`}}let e=t.replace(/_/g,"-");this.previewUtility.updateDynamicStyles(`${e}-link-inline-css`,o)}_getDecoration(t){return api(t)()}_getColor(t,o=!1){let e=api(t)()||"";return this.paletteSelector.getColor(e,o)}}